package im.grusis.mkb;

import org.junit.Assert;
import org.testng.annotations.Test;

/**
 * User: Mothership
 * Date: 13-5-12
 * Time: 下午7:49
 */
public class xxteaTest {

  @Test
  public void longArrayAndStringConversion() {
    String string = "This is a string";

    int[] intArray = XXTEA.stringToIntArray(string, false);
    Assert.assertArrayEquals(new int[] {1936287828, 544434464, 1953701985, 1735289202}, intArray);
    String result = XXTEA.intArrayToString(intArray, false);
    Assert.assertEquals(string, result);

    intArray = XXTEA.stringToIntArray(string, true);
    Assert.assertArrayEquals(new int[]{1936287828, 544434464, 1953701985, 1735289202, 16}, intArray);
    result = XXTEA.intArrayToString(intArray, true);
    Assert.assertEquals(string, result);

    string = "This_Is_Another_String";
    intArray = XXTEA.stringToIntArray(string, false);
    Assert.assertArrayEquals(new int[] {1936287828, 1601390943, 1953459777, 1601332584, 1769108563, 26478}, intArray);
    result = XXTEA.intArrayToString(intArray, false);
    Assert.assertEquals(string, result);

    intArray = XXTEA.stringToIntArray(string, true);
    Assert.assertArrayEquals(new int[]{1936287828, 1601390943, 1953459777, 1601332584, 1769108563, 26478, 22}, intArray);
    result = XXTEA.intArrayToString(intArray, true);
    Assert.assertEquals(string, result);

    intArray = new int[] {744133714,1442689526,-1756678249,1958960298,1666444042,363532449,1522869684,326129130,2068295067,1200958916,-156314226,-561103368,-2071354929,1097447860,-1194902372,331116709,-1115683497,548071681,-426251272,-74582883,875446691,714751630,82098821,-847650081,-1749939724,1243804985,374440886,-2032348385,581718788,-709063459,-1058867791,-1300666635,-224557936,-2041208534,1626328706,-1276874915,-1971917144,-1377005881,564743884,-1869042337,-1239702562,-339728249,-590217249,-1720385703,1036858700,-197820740,-611985403,1236411203,1158764078,2117499185,861590659,-1172557075,-227914519,454189855,564114306,-426593762,-264594683,1075308504,-1351658083,-1281462289,-1267648484,-2061471489,948856181,-1184832680,1871284485,1858951503,-1833186945,-1402497910,-167953108,-1570107053,2007063943,2001377439,1925243854,103788792,1245799116,-407942204,-1243978550,-504115862,-1992462418,-1371849562,278342439,1363581419,422682264,1809843165,1247974779,1859941916,-240847594,87790978,2011729953,-147122884,-848108561,424567724,1557189572,-1191293550,-1429013802,-1280660980,1869616391,-1637406431,-1289931373,-409350228,-2072547091,210828827,455389594,-1760523971,852589439,1501073622,-1480947522,-493884235,-1635600829,580178911,-1149768879,1656104910,130061653,-2115959001,-957002125,417761321,1756712318,-260210347,2111007826,-1491237823,-280365993,1593147963,-643976042,-583164473,-1445438526,-854582715,-1114293592,496418864,1067888436,1114478452,1453319463,1580470845,-1003183404,-971409011,1031181865,642741346,373206076,1010365564,1704905704,655959707,33273443,1460934524,-1756403111,-44425938,1338405859,-1226582517,-490708939,391313029,-1824853508,-259828963,1439651415,289519162,1809170200,-611194535,2128034720,-759115246,-406098580,397202635,-1369202188,787246090,1407891945,1082180766,-1086512126,-2061415091,531853075,1366601306,-1654047701,894909836,-543450280,970807968,929339641,1078911611,-588645539,942170458,-475107792,1957926687,-1803733650,1426649356,-1793549162,436986487,-291907861,653890303,-2089284143,1667754641,1500927675,1847793388,-2107812469,118722642,-1624508380,467650832,-554867681,1873438819,721111630,-1550654253,308639407,2000126354,-1801030244,1249192847,-916757520,-2061392939,-2079098952,918168263,1313978583,1764059125,-2119968152,151159452,-2075125413,-1106797477,-1138499147,518616821,-1560718071,1042914179,-1771528338,1407072132,22380948,169410910,-1851881463,-810179822,-677972887,-1767165469,-506719146,362216931,-14735688,1868259790,-1492133091,1498020926,-1968568091,1481534940,-79383456,456051547,-572521604,655958197,1800606279,307696164,-2120212496,1128323170,984739630,1328970360,-1660039484,1401918040,1642030649,-1778381295,-1051320073,761390398,1289324928,-912457858,-1856762852,582377470,72030654,273293567,1624704130,-662206758,-1131116162,116943916,-80006578,1570229275,-1367525759,1644944479,-730550606,-190389575,-116745023,-619659479,-416240199,1798088320,1974424612,-838689416,-1660201864,-1455074061,1235478801,329345190,1249854743,414118263,942427599,1771915020,-2806937,-947914236,-490072038,-1529114005,1530437213,63944927,-1398693732,2100915698,-1393975347,54973377,1865398814,1444114098,-1359893375,1819696226,233101853,1992780528,879200200,-920185280,1263377444,380862697,-1001495392,-1028975346,-1305194670,298873576,1948685096,-1096910569,-1476622515,-607112577,15335139,-38819569,702176418,133410700,129092357,521442555,1780987800,1595339533,1647257965,400222372,-517433211,1654482590,-2133707987,-1617397291,1564623771,148944640,1107228885,-813651450,-147973086,656158682,-662867456,-2037845622,-2001726289,-280983062,1704721673,-167319440,86949595,1614497953,830254904,827317018,2125060386,-458420049,-1280218804,914086180,1630726667,-4987280,-879317140,139301532,-615189669,97290544,-1942959423,-1663940083,-519718274,1137336633,1457109448,841504027,1138788284,-617794382,2027526731,-955788345,-1047766000,997694443,1458538190,-89857598,628818742,-1751140964,-2089614203,-1737850660,1239539149,1608029526,2141886674,792936867,-1614009815,473684572,-1673939274,-803183873,-1368064358,-1966183318,229052582,1257060523,-751968587,-2083220397,-41857786,-1234299861,-423199684,-1275865523,-1898511547,-134617971,-216644846,769897091,1449814634,1649359366,857471182,-593288166,-2067914518,-1328880795,-795640690,-693804503,1201895475,-81701153,-3689315,-7773140,2105635888,265935989,382346631,1629284421,-1728355210,-402507692,68376920,857706682,-1102126869,1040074366,929293283,-1138366561,477474516,-1309694875,-318613784,-1292300270,-2035686301,1570531771,1979241264,-1941180278,731054466,-830714200,2137961420,-497704452,761262808,268209376,1505749864,1551365943,1765973965,1496226583,437012257,1490463044,-575781356,2109619242,-2081133852,1884005012,2031456503,-1102828786,-1476113823,-27354564,-795208549,1270439664,2042740554,-1478503228,232072219,-2139085039,-385569721,594478380,-1017945889,1764273446,1003069063,-528074739,1676315048,229114005,1169328485,-951646265,-107448295,466359861,343319804,-651900443,-843607549,-2014309499,973007946,2092874077,-1861742573,-166169620,-2022336910,-1686953188,-582909922,954214419,1203905092,-2045036858,-1074090489,2120845582,626974528,160517803,724957957,1939441522,369735053,-1722636994,351520526,-1586132305,949557269,236883707,-103024585,1556708666,-1389038211,-1413682157,1479509178,-723461026,63424744,-544972373,549282674,849197450,-1201857122,-1756146167,403887526,511966996,1790682692,-1039988680,1064027002,-120613230,1275821143,-1962297673,453099903,-691753803,2053801167,1889350465,-678348971,671818585,1839926318,-509873020,1254645180,2025269449,1906500881,-1682539943,-1101104783,-1172403364,1911399762,1987240839,95971067,-1664709061,1770072643,1803140661,-815951977,634669237,-821051950,1065637361,-1778901505,911553788,-536370568,1933392253,1535549264,-72199364,1349923745,1690322983,-1039969827,533184626,1036203061,566356966,332983146,1916461341,847425945,1245216155,-853965507,-675653173,-2007500236,-1519336279,1643374115,-277527035,-133725705,-1945578866,-69101858,-759841646,-1085668979,-545943786,902384290,-1373699987,666740033,1088878028,1758235320,-1423721718,-1784834703,167942955,-1896733950,-201339102,-692542113,-1387271008,202513375,-991132015,327870573,-844120845,-2062194287,1428902990,471408576,690806947,2048723727,-1195161150,257015806,1023479321,209811324,1612946771,131539911,-926627449,-1509195557,-11567249,1900978790,-1284044588,-1991361156,-1347608398,-1669412309,152141438,-857680444,1005472655,-1811098312,-318812158,1645056658,-2082414020,972208004,617560574,671903724,-1109574979,813992156,660490815,-1299391887,1398506461,-1211331745,2026229722,-1241645524,-1285268656,170903239,96253101,2004509992,1458745036,1947582424,-1732171167,2050619705,-11803514,-1892763303,159461989,1218430467,-503423894,-1350014057,41374752,-1654609485,-741346171,-1666544223,1723117264,-2044499212,-1111784018,378804143,-1164619247,1313721700,1173600525,776002706,-1356281725,440604228,366973859,2136471626,-562620665,-887595866,546296996,825393639,-2135766674,-115021234,-1554905913,-855211615,-470273551,-20328453,1633525669,-368396059,-1593572143,894743447,389498570,-1910841538,-2124526972,-1290768891,1654623931,-666762300,-2112541426,1551482486,-2126024019,1330411615,-1769881512,-1234087537,-2107495931,27050368,-2013635419,564077944,-136979249,-1345987778,909306308,1793461673,1617549825,-2106882747,90580395,915055280,780717985,421068968,2082224370,904316835,-495270967,1643763458,178354673,-232544627,858659527,-2018140096,1381791745,1374706935,-1041492282,-1314480454,31326967,-1937439601,1946145553,-2013412409,-665425232,262751749,-1756119632,-139770883,-1013003995,1296978368,-506809410,2131516622,-2075474472,844339737,1678451593,-1666206505,1456114823,-1168824292,1827121497,1467907734,1214292462,1807171038,-1370061671,634301309,-1314042513,67855002,-1551831694,2121718860,1542456608,1609860446,1551210529,2104976546,-278105391,357439516,-1015897824,319475017,-977175200,-30903717,-1928467786,2022894607,-1279592669,-2097338640,-2065703133,-420429883,789078652,656911641,-1708308474,1944481694,1598624058,-1797234132,-1535812239,-803972655,-1392148409,1248224649,1320217668,-1446142711,-1223238135,-27967733,-1817066541,-1032321518,850207118,696070857,-25595447,-677040620,-1605371080,-17905539,274285736,778777887,1656526097,398851213,965765695,-900885274,-185500906,-581484591,-1011732504,-1679235056,614785801,336268994,-1123850099,-1083763211,-509110244,830483568,2028831612,-1070353382,-216576849,-323967554,884995296,781353540,1941077320,825675746,-1752077919,-804915572,1385243913,-1877306106,865786139,-1382406665,629057703,1843986902,86772408,-704101888,1094527531,-1243811941,-1317800301,-1404120646,-481026989,-1810393685,2047868265,1334652815,1356086869,1288963841,-38976844,108219325,-842880664,1455956076,-588573572,302336659,-1447688818,112063662,75328478,1797643872,2065431861,-549916900,1947161614,1593174884,-146729032,400349364,-1675029256,768273224,-799618605,-919804864,1150369407,-376483092,1912163674,-1941295928,217424870,-4007248,152518474,1836875060,1123482801,1052693623,860643101,1682977715,-531693745,-1710357136,-1735479892,1916540721,1990075094,125365145,-589507080,1638846465,1586650166,-1108105620,915132667,934096060,-596196080,-842225661,1532846080,-1226544654,1596899141,-2023731848,-878205476,-225193958,-677477456,1323641534,921246628,-578260697,-925073985,1763856503,3412};
    result = XXTEA.intArrayToString(intArray, false);
    Assert.assertArrayEquals(intArray, XXTEA.stringToIntArray(result, false));
  }

  @Test
  void decryptAndEncrypt() {
    String string = "to be encrypted";
    String key = "key";
    int[] encryptedLongArray = XXTEA.stringToIntArray(XXTEA.encrypt(string, key), false);
    Assert.assertArrayEquals(new int[] {1202067163, 564852801, -522773858, 1633597383, -1397140425}, encryptedLongArray);

    string = "RAW_STRING";
    key = "another key";
    encryptedLongArray = XXTEA.stringToIntArray(XXTEA.encrypt(string, key), false);
    Assert.assertArrayEquals(new int[] {318749921, 1024289719, 544685602, -608595361}, encryptedLongArray);

//    String string = "TEST1";
//    String key = "KEY";
//    String encryptedString = XXTEA.encrypt(string, key);
//    int[] encryptedLongArray = XXTEA.stringToIntArray(encryptedString, false);
//    Assert.assertArrayEquals(new int[] {-1539774446, -1444600615, -658899989}, encryptedLongArray);


//    String data = "a:1:{i:0;s:57:\"{\"gameName\":\"CARD-ANDROID-CHS\",\"locale\":\"\",\"udid\":\"null\"}\";}";
//    String key = XXTEA.intArrayToString(new int[]{-349701818, -972042614, -511001106, -648243089}, false);
//    String encrypted = XXTEA.encrypt(data, key);
//
//    String result = XXTEA.decrypt(encrypted, key);
//    Assert.assertEquals(data, result);
  }

}
